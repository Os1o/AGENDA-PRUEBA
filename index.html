<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Directorio Empresarial - Direcci√≥n Jur√≠dica</title>
    <link rel="stylesheet" href="css/styles.css">
    <meta name="description" content="Sistema integral de gesti√≥n de personal y directorio empresarial">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <div class="logo-icon">DJ</div>
                <div class="logo-text">Directorio Jur√≠dico</div>
            </div>
            
            <ul class="nav-links">
                <li><a href="index.html" class="active">Inicio</a></li>
                <li><a href="directorio.html">Directorio</a></li>
                <li><a href="organigrama.html">Organigrama</a></li>
                <li><a href="insumos.html">Insumos</a></li>
                <li><a href="contacto.html">Contacto</a></li>
            </ul>
            
            <div class="nav-actions">
                <!-- B√∫squeda r√°pida en el header -->
                <div class="quick-search" id="quickSearch" style="display: none;">
                    <input type="text" 
                           class="quick-search-input" 
                           placeholder="Buscar empleado..." 
                           id="quickSearchInput">
                    <button class="quick-search-btn" onclick="quickSearch()">üîç</button>
                </div>
                
                <!-- Bot√≥n de b√∫squeda -->
                <button class="search-toggle" onclick="toggleQuickSearch()" title="B√∫squeda r√°pida">
                    üîç
                </button>
                
                <!-- Men√∫ m√≥vil -->
                <button class="mobile-menu" onclick="toggleMobileMenu()">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
            </div>
        </div>
        
        <!-- Men√∫ m√≥vil desplegable -->
        <div class="mobile-nav" id="mobileNav">
            <div class="mobile-nav-content">
                <a href="index.html" class="mobile-nav-link active">
                    <span class="mobile-nav-icon">üè†</span>
                    Inicio
                </a>
                <a href="directorio.html" class="mobile-nav-link">
                    <span class="mobile-nav-icon">üìã</span>
                    Directorio
                </a>
                <a href="organigrama.html" class="mobile-nav-link">
                    <span class="mobile-nav-icon">üè¢</span>
                    Organigrama
                </a>
                <a href="insumos.html" class="mobile-nav-link">
                    <span class="mobile-nav-icon">üì¶</span>
                    Insumos
                </a>
                <a href="contacto.html" class="mobile-nav-link">
                    <span class="mobile-nav-icon">üìû</span>
                    Contacto
                </a>
                
                <!-- Informaci√≥n adicional en m√≥vil -->
                <div class="mobile-nav-info">
                    <div class="mobile-nav-section">
                        <h4>Sistema</h4>
                        <p>Directorio Empresarial</p>
                        <p>Versi√≥n 1.2.0</p>
                    </div>
                    
                    <div class="mobile-nav-section">
                        <h4>Soporte</h4>
                        <p>üìß soporte@empresa.com</p>
                        <p>üìû +52 55 1234 5678</p>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Overlay para cerrar men√∫ m√≥vil -->
    <div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileMenu()"></div>
    
    <main class="main-content">
        <!-- P√°gina Principal -->
        <div class="main-page" id="mainPage">
            <div class="hero">
                <h1>Directorio Empresarial</h1>
                <p>Sistema integral de gesti√≥n de personal - Direcci√≥n Jur√≠dica</p>
            </div>

            <div class="modules-grid">
                <div class="module-card" onclick="showDirectory('ubicacion')">
                    <div class="module-icon">üìç</div>
                    <div class="module-title">Por Ubicaci√≥n</div>
                    <div class="module-description">Encuentra empleados por su ubicaci√≥n f√≠sica y piso de trabajo</div>
                </div>
                
                <div class="module-card" onclick="showDirectory('adscripcion')">
                    <div class="module-icon">üè¢</div>
                    <div class="module-title">Por Adscripci√≥n</div>
                    <div class="module-description">Organiza el personal por departamentos y √°reas de trabajo</div>
                </div>
                
                <div class="module-card" onclick="showDirectory('categoria')">
                    <div class="module-icon">üë§</div>
                    <div class="module-title">Por Categor√≠a</div>
                    <div class="module-description">Clasifica empleados por jerarqu√≠a y tipo de puesto</div>
                </div>
                
                <div class="module-card" onclick="showDirectory('completo')">
                    <div class="module-icon">üìã</div>
                    <div class="module-title">Listado Completo</div>
                    <div class="module-description">Visualiza todo el personal en un directorio completo</div>
                </div>
            </div>
        </div>

        <!-- P√°gina de Directorio -->
        <div class="directory-page" id="directoryPage">
            <div class="directory-header">
                <div class="directory-nav">
                    <button class="back-button" onclick="showMain()">
                        <span>‚Üê</span> Regresar
                    </button>
                    <div class="directory-title">Agenda Direcci√≥n Jur√≠dica</div>
                    <div class="search-container">
                        <input type="text" class="search-input" placeholder="Buscar empleado o ID..." id="searchInput">
                        <button class="search-button" onclick="searchEmployees()">üîç Buscar</button>
                    </div>
                </div>
            </div>

            <div class="content-area">
                <div id="loadingState" class="loading" style="display: none;">
                    üîÑ Cargando empleados desde la base de datos...
                </div>

                <div id="errorState" class="error" style="display: none;">
                    ‚ùå Error al cargar datos. Revisa la conexi√≥n a la base de datos.
                </div>

                <div id="employeeContent" style="display: none;">
                    <div class="controls-section">
                        <div class="sort-controls">
                            <button class="sort-button active" onclick="sortBy('az')">A ‚Üí Z</button>
                            <button class="sort-button" onclick="sortBy('za')">Z ‚Üí A</button>
                        </div>
                        <div class="results-info">
                            <span id="totalRecords">0 registros encontrados</span>
                        </div>
                    </div>

                    <div class="employees-grid" id="employeesGrid">
                        <!-- Los empleados se cargar√°n aqu√≠ -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <!-- Informaci√≥n principal del footer -->
            <div class="footer-grid">
                <!-- Secci√≥n: Informaci√≥n de la empresa -->
                <div class="footer-section">
                    <h3>Direcci√≥n Jur√≠dica</h3>
                    <p>Sistema integral de gesti√≥n de personal y directorio empresarial.</p>
                    <p>Optimizando la comunicaci√≥n interna y la organizaci√≥n departamental.</p>
                    
                    <!-- Estad√≠sticas del sistema -->
                    <div class="footer-stats">
                        <div class="stat-item">
                            <span class="stat-number" id="footerTotalEmployees">-</span>
                            <span class="stat-label">Empleados</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="footerTotalDepartments">-</span>
                            <span class="stat-label">Departamentos</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="footerSystemStatus">‚óè</span>
                            <span class="stat-label">Estado</span>
                        </div>
                    </div>
                </div>
                
                <!-- Secci√≥n: Enlaces r√°pidos -->
                <div class="footer-section">
                    <h3>Enlaces R√°pidos</h3>
                    <div class="footer-links">
                        <a href="index.html">
                            <span class="link-icon">üè†</span>
                            P√°gina Principal
                        </a>
                        <a href="directorio.html">
                            <span class="link-icon">üìã</span>
                            Directorio Completo
                        </a>
                        <a href="organigrama.html">
                            <span class="link-icon">üè¢</span>
                            Organigrama
                        </a>
                        <a href="insumos.html">
                            <span class="link-icon">üì¶</span>
                            Gesti√≥n de Insumos
                        </a>
                        <a href="contacto.html">
                            <span class="link-icon">üìû</span>
                            Informaci√≥n de Contacto
                        </a>
                    </div>
                </div>
                
                <!-- Secci√≥n: Soporte t√©cnico -->
                <div class="footer-section">
                    <h3>Soporte T√©cnico</h3>
                    <div class="footer-links">
                        <a href="#" onclick="showHelp()">
                            <span class="link-icon">‚ùì</span>
                            Mesa de Ayuda
                        </a>
                        <a href="#" onclick="showManual()">
                            <span class="link-icon">üìñ</span>
                            Manual de Usuario
                        </a>
                        <a href="#" onclick="reportIssue()">
                            <span class="link-icon">üêõ</span>
                            Reportar Problema
                        </a>
                        <a href="#" onclick="showChangelog()">
                            <span class="link-icon">üìù</span>
                            Notas de Versi√≥n
                        </a>
                        <a href="#" onclick="downloadBackup()">
                            <span class="link-icon">üíæ</span>
                            Respaldo de Datos
                        </a>
                    </div>
                </div>
                
                <!-- Secci√≥n: Informaci√≥n de contacto -->
                <div class="footer-section">
                    <h3>Informaci√≥n de Contacto</h3>
                    <div class="contact-info">
                        <div class="contact-item">
                            <span class="contact-icon">üìß</span>
                            <div class="contact-details">
                                <strong>Email:</strong>
                                <a href="mailto:soporte@empresa.com">soporte@empresa.com</a>
                            </div>
                        </div>
                        
                        <div class="contact-item">
                            <span class="contact-icon">üìû</span>
                            <div class="contact-details">
                                <strong>Tel√©fono:</strong>
                                <a href="tel:+525512345678">+52 55 1234 5678</a>
                            </div>
                        </div>
                        
                        <div class="contact-item">
                            <span class="contact-icon">üè¢</span>
                            <div class="contact-details">
                                <strong>Ubicaci√≥n:</strong>
                                <span>Piso 6 Oriente</span>
                            </div>
                        </div>
                        
                        <div class="contact-item">
                            <span class="contact-icon">üïê</span>
                            <div class="contact-details">
                                <strong>Horario:</strong>
                                <span>Lun - Vie: 9:00 - 18:00</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Redes sociales / Enlaces adicionales -->
                    <div class="social-links">
                        <a href="#" class="social-link" title="Intranet corporativa">
                            <span class="social-icon">üåê</span>
                        </a>
                        <a href="#" class="social-link" title="Sistema de tickets">
                            <span class="social-icon">üé´</span>
                        </a>
                        <a href="#" class="social-link" title="Portal de empleados">
                            <span class="social-icon">üë•</span>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Secci√≥n inferior del footer -->
            <div class="footer-bottom">
                <div class="footer-bottom-content">
                    <div class="footer-left">
                        <p>&copy; <span id="currentYear">2025</span> Direcci√≥n Jur√≠dica. Todos los derechos reservados.</p>
                        <p class="footer-subtitle">
                            Desarrollado con ‚ù§Ô∏è para mejorar la comunicaci√≥n interna | Versi√≥n 1.2.0
                        </p>
                    </div>
                    
                    <div class="footer-center">
                        <div class="footer-badges">
                            <span class="badge badge-php" title="Desarrollado en HTML5">HTML5</span>
                            <span class="badge badge-responsive" title="Dise√±o responsivo">üì±</span>
                            <span class="badge badge-secure" title="Conexi√≥n segura">üîí</span>
                        </div>
                    </div>
                    
                    <div class="footer-right">
                        <div class="footer-actions">
                            <button class="footer-btn" onclick="scrollToTop()" title="Ir arriba">
                                ‚Üë Subir
                            </button>
                            <button class="footer-btn" onclick="toggleTheme()" title="Cambiar tema">
                                üåô Tema
                            </button>
                            <button class="footer-btn" onclick="printPage()" title="Imprimir p√°gina">
                                üñ®Ô∏è Imprimir
                            </button>
                        </div>
                        
                        <!-- Informaci√≥n del sistema -->
                        <div class="system-info">
                            <small>
                                √öltima actualizaci√≥n: <span id="lastUpdated"></span> |
                                Servidor: <span id="serverName"></span>
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Widget de estado del sistema -->
        <div class="system-status-widget" id="systemStatusWidget">
            <div class="status-indicator">
                <span class="status-dot" id="statusDot"></span>
                <span class="status-text" id="statusText">Verificando conexi√≥n...</span>
            </div>
            <div class="status-details" id="statusDetails" style="display: none;">
                <div class="status-item">
                    <span class="status-label">Base de datos:</span>
                    <span class="status-value" id="dbStatus">Conectando...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">√öltima sincronizaci√≥n:</span>
                    <span class="status-value" id="lastSync">--:--</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Rendimiento:</span>
                    <span class="status-value" id="performance">--ms</span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal de ayuda -->
    <div id="helpModal" class="modal-overlay" style="display: none;">
        <div class="modal-content help-modal">
            <div class="modal-header">
                <h3>Centro de Ayuda</h3>
                <button class="modal-close" onclick="closeModal('helpModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="help-sections">
                    <div class="help-section">
                        <h4>Navegaci√≥n B√°sica</h4>
                        <ul>
                            <li>Use los m√≥dulos de la p√°gina principal para acceder a diferentes vistas</li>
                            <li>La b√∫squeda se puede realizar desde cualquier p√°gina</li>
                            <li>Use ESC para cerrar ventanas modales</li>
                        </ul>
                    </div>
                    <div class="help-section">
                        <h4>B√∫squeda de Empleados</h4>
                        <ul>
                            <li>Busque por nombre, ID, ubicaci√≥n o departamento</li>
                            <li>Use filtros para refinar resultados</li>
                            <li>Los resultados se actualizan en tiempo real</li>
                        </ul>
                    </div>
                    <div class="help-section">
                        <h4>Problemas Comunes</h4>
                        <ul>
                            <li>Si no ve datos, verifique la conexi√≥n a internet</li>
                            <li>Actualice la p√°gina si los datos no cargan</li>
                            <li>Use el bot√≥n "Reportar Problema" para issues t√©cnicos</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/script.js"></script>
    
    <!-- Script de inicializaci√≥n -->
    <script>
        // Variables del sistema (reemplazando PHP)
        const APP_CONFIG = {
            name: 'Directorio Empresarial',
            version: '1.2.0',
            description: 'Sistema integral de gesti√≥n de personal - Direcci√≥n Jur√≠dica',
            company: 'Direcci√≥n Jur√≠dica',
            email: 'soporte@empresa.com',
            phone: '+52 55 1234 5678'
        };

        // Inicializar informaci√≥n din√°mica
        document.addEventListener('DOMContentLoaded', function() {
            // Actualizar a√±o actual
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            
            // Actualizar fecha de √∫ltima actualizaci√≥n
            document.getElementById('lastUpdated').textContent = new Date().toLocaleDateString();
            
            // Actualizar nombre del servidor
            document.getElementById('serverName').textContent = window.location.hostname;
            
            // Inicializar la aplicaci√≥n
            console.log(APP_CONFIG.name + ' v' + APP_CONFIG.version + ' iniciado');
            
            // Cargar estad√≠sticas iniciales
            loadInitialStats();
            
            // Configurar eventos del header y footer
            setupAllEventListeners();
        });
        
        // Cargar estad√≠sticas iniciales
        async function loadInitialStats() {
            try {
                const { data: empleados, error } = await supabase
                    .from('empleados')
                    .select('*');
                
                if (!error && empleados) {
                    // Actualizar estad√≠sticas en footer
                    document.getElementById('footerTotalEmployees').textContent = empleados.length;
                    
                    // Calcular departamentos √∫nicos
                    const departamentos = [...new Set(empleados.map(emp => emp.categoria))].filter(Boolean);
                    document.getElementById('footerTotalDepartments').textContent = departamentos.length;
                    
                    // Estado del sistema
                    const statusElement = document.getElementById('footerSystemStatus');
                    const statusDot = document.getElementById('statusDot');
                    const statusText = document.getElementById('statusText');
                    
                    if (statusElement) statusElement.textContent = '‚óè';
                    if (statusElement) statusElement.style.color = '#27ae60';
                    if (statusDot) statusDot.className = 'status-dot online';
                    if (statusText) statusText.textContent = 'Sistema operativo';
                }
            } catch (error) {
                console.error('Error cargando estad√≠sticas:', error);
                updateSystemStatus('error', 'Error de conexi√≥n');
            }
        }
        
        // Configurar todos los event listeners
        function setupAllEventListeners() {
            // Event listeners del header
            setupHeaderEvents();
            
            // Event listeners del footer  
            setupFooterEvents();
            
            // Event listeners generales
            setupGeneralEvents();
        }
        
        // Funciones del header
        function setupHeaderEvents() {
            // B√∫squeda en tiempo real con debounce
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                let searchTimeout;
                searchInput.addEventListener('input', function() {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        searchEmployees();
                    }, 300);
                });

                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchEmployees();
                    }
                });
            }
        }
        
        // Funciones del footer
        function setupFooterEvents() {
            // Toggle del widget de estado
            const widget = document.getElementById('systemStatusWidget');
            const details = document.getElementById('statusDetails');
            
            if (widget) {
                widget.addEventListener('click', function() {
                    const isVisible = details.style.display !== 'none';
                    details.style.display = isVisible ? 'none' : 'block';
                });
            }
            
            // Actualizar estad√≠sticas cada 5 minutos
            setInterval(loadInitialStats, 5 * 60 * 1000);
        }
        
        // Event listeners generales
        function setupGeneralEvents() {
            // Navegaci√≥n con teclado
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const directoryPage = document.getElementById('directoryPage');
                    if (directoryPage && directoryPage.style.display !== 'none') {
                        showMain();
                    }
                    
                    // Cerrar b√∫squeda r√°pida
                    const quickSearch = document.getElementById('quickSearch');
                    if (quickSearch && quickSearch.style.display !== 'none') {
                        toggleQuickSearch();
                    }
                    
                    // Cerrar men√∫ m√≥vil
                    closeMobileMenu();
                    
                    // Cerrar modales
                    const modals = document.querySelectorAll('.modal-overlay');
                    modals.forEach(modal => modal.style.display = 'none');
                }
            });
        }
    </script>
</body>
</html>